---
import HeaderLink from '@/components/HeaderLink.astro'
import Search from '@/components/Search.astro'

import type { SocialNetwork } from '@/site-config'
import { siteConfig } from '@/site-config'

// Importar los iconos .astro que vayamos a usar en el header:
import TagIcon from '@/components/icons/TagIcon.astro'
import ToggleTheme from '@/components/icons/ToggleTheme.astro'
import MenuIcon from '@/components/icons/MenuIcon.astro'

// Este “mapa” contiene también los iconos de redes sociales (Twitter/Github)
import TwitterIcon from '@/components/icons/TwitterIcon.astro'
import GithubIcon from '@/components/icons/GithubIcon.astro'

const iconMap: Record<string, any> = {
	TwitterIcon,
	GithubIcon
	// si agregas más, añádelos aquí...
}

const { socials } = siteConfig as { socials: SocialNetwork[] }
---

<!-- src/components/Header.astro -->
<link rel='stylesheet' href='/src/styles/Header.css' />

<header class='header-container'>
	<div class='header-content'>
		<a class='header-logo' href='/'>MiBlog</a>

		<nav class='nav-primary'>
			<HeaderLink href='/' class='nav-link'>Home</HeaderLink>
			<HeaderLink href='/tags' class='nav-link flex items-center gap-1'>
				<TagIcon width='18' height='18' /> Tags
			</HeaderLink>
			<HeaderLink href='/about' class='nav-link'>Acerca</HeaderLink>
			<HeaderLink href='/contact' class='nav-link'>Contacto</HeaderLink>
		</nav>

		<div class='header-actions'>
			<div class='hidden sm:block'>
				<Search />
			</div>
			<ToggleTheme />
			<button id='header-drawer-button' type='button' class='hamburger-button md:hidden'>
				<MenuIcon width='24' height='24' />
				<span class='sr-only'>Mostrar menú</span>
			</button>
		</div>
	</div>

	<!-- Drawer móvil -->
	<div id='header-drawer' class='drawer hidden translate-x-full'>
		<nav class='drawer-nav'>
			<HeaderLink href='/' class='drawer-link'>Home</HeaderLink>
			<HeaderLink href='/tags' class='drawer-link flex items-center gap-1'>
				<TagIcon width='18' height='18' /> Tags
			</HeaderLink>
			<HeaderLink href='/about' class='drawer-link'>Acerca</HeaderLink>
			<HeaderLink href='/contact' class='drawer-link'>Contacto</HeaderLink>

			<!-- Aquí hacemos el render de las redes sociales -->
			<div class='drawer-socials'>
				{
					socials.map((network: SocialNetwork) => {
						const IconComponent = iconMap[network.iconName]
						if (!IconComponent) return null
						return (
							<HeaderLink
								href={network.url}
								target='_blank'
								rel='noopener'
								aria-label={network.name}
								class='drawer-social-link'
							>
								<IconComponent width='20' height='20' />
							</HeaderLink>
						)
					})
				}
			</div>

			<div class='drawer-search mt-4'>
				<Search />
			</div>
		</nav>
	</div>
</header>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const drawer = document.getElementById('header-drawer')!
		const button = document.getElementById('header-drawer-button')!
		button.addEventListener('click', () => {
			drawer.classList.toggle('hidden')
			drawer.classList.toggle('translate-x-full')
		})
		document.addEventListener('click', (event) => {
			const target = event.target as Node
			if (!drawer.contains(target) && !button.contains(target)) {
				drawer.classList.add('hidden')
				drawer.classList.add('translate-x-full')
			}
		})
	})
</script>
